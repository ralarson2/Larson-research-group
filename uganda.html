    </div> <!-- closes the Recent measurements .card -->

    <div class="section-title" style="margin-top:1.6rem;">Project area</div>
    <div id="uganda-map"></div>

    <div class="card" style="margin-top:1.2rem; font-size:0.9rem;">
      <div style="font-size:1rem; color: var(--dark); margin-bottom:0.35rem;">
        Funding and data acknowledgment
      </div>
      <p>
        This work is supported by the Energy Policy Institute at the University of Chicago (EPIC).
        Air quality data are provided by AirQo through its open data access program.
      </p>
    </div>
  </section>
</main>

<footer>
  <div class="footer-inner">
    <div>Larson Research Group · University of Wisconsin–Madison</div>
    <div>Hosted on GitHub Pages</div>
  </div>
</footer>

<script>
async function loadUgandaData() {
  const tbody = document.getElementById("uganda-data-body");
  const statusEl = document.getElementById("uganda-status");
  const table = document.getElementById("uganda-data-table");

  const locationMap = {
    "airqo_g5563": "Bulange Mengo, Kampala",
    "airqo_g5567": "Kamwokya Oldkiira, Kampala",
    "aq_43": "Lukuli Makindye, Makindye",
    "aq_72": "Luwafu, Makindye",
    "aq_g520": "Wabigalo, Kampala",
    "airqo_g5548": "Mbuya Nadiope, Kampala",
    "airqo_g5438": "St. Ponsiano Primary School, Makindye",
    "airqo_g5446": "Kitintale Ntensibe, Kampala",
    "airqo_g5564": "Busabala, Wakiso",
    "aq_g5_43": "Katwe 1, Makindye",
    "aq_g5_46": "Ggaba, Makindye",
    "aq_g5_48": "Kabalagala Town, Makindye",
    "aq_g5_53": "Kansanga Seed Secondary School, Kampala",
    "aq_g5_97": "Mbuya II, Nakawa",
    "airqo_g5449": "Rustic Expeditions Muyenga, Kampala"
  };

  const res = await fetch("https://api.airqo.net/api/v2/devices/measurements/cohorts/68d4e669670d2e0013c85375?token=V6ZFRJXEAGRKRSYU");
  const data = await res.json();
  const rows = (data.measurements || data.results || []).slice(0,15);

  tbody.innerHTML = "";

  rows.forEach(item => {
    const tr = document.createElement("tr");

    const pm25 = Number(item.pm2_5?.value);
    let cls = "";
    if (!isNaN(pm25)) {
      if (pm25 <= 15) cls = "aq_who_g1";
      else if (pm25 <= 25) cls = "aq_who_it4";
      else if (pm25 <= 37.5) cls = "aq_who_it3";
      else if (pm25 <= 50) cls = "aq_who_it2";
      else if (pm25 <= 75) cls = "aq_who_it1";
      else cls = "aq_who_high";
    }
    tr.className = cls;

    const loc = locationMap[item.device] || item.device || "Unknown";
    const parts = loc.split(",");

    const pm10Val = item.pm10?.value;

    tr.innerHTML = `
      <td>
        <div>${parts[0].trim()}</div>
        <div style="font-size:0.8em;color:#4b5c67;">${parts.slice(1).join(",").trim()}</div>
      </td>
      <td>${item.time || item.created_at || ""}</td>
      <td>${isNaN(pm25) ? "" : pm25.toFixed(1)}</td>
      <td>${(typeof pm10Val === "number") ? pm10Val.toFixed(1) : ""}</td>
    `;
    tbody.appendChild(tr);
  });

  statusEl.textContent = "";
  table.style.display = "";
}

function initMap() {
  const map = L.map("uganda-map").setView([0.3136, 32.5811], 12);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
}

initMap();
loadUgandaData();
</script>
</body>
</html>
